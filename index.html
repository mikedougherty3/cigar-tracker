<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/slate/bootstrap.min.css" integrity="sha384-8iuq0iaMHpnH2vSyvZMSIqQuUnQA7QM+f6srIdlgBrTSEyd//AWNMyEaSF2yPzNQ" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
  <style>
    .hide {
      display: none !important;
    }

    hr {
      background-color: #ccc;
    }

    /* Extra small devices (phones, 600px and down) */
    /* @media only screen and (max-width: 600px) {
      html {
        font-size: 2rem !important;
      }

      body {
        background-color: red;
      }
    } */

    /* Small devices (portrait tablets and large phones, 600px and up) */
    /* @media only screen and (min-width: 600px) {
      html {
        font-size: 1.6rem !important;
      }

      body {
        background-color: black;
      }
    } */

    /* Medium devices (landscape tablets, 768px and up) */
    @media only screen and (min-width: 768px) {
      html {
        font-size:2rem !important;
      }
    }

    /* Large devices (laptops/desktops, 992px and up) */
    @media only screen and (min-width: 992px) {
      html {
        font-size: 1.2rem !important;
      }
    }

    /* Extra large devices (large laptops and desktops, 1200px and up) */
    @media only screen and (min-width: 1200px) {
      html {
        font-size: 1rem !important;
      }
    }
  </style>
  <!-- <style>
    .hide {
      display: none !important;
    }

    /***********************
    **      Dropdown      **
    ***********************/
    .dropbtn {
      background-color: #e13030;
      color: white;
      margin: 0px 5px;
      /* padding: 16px;
      font-size: 16px;
      border: none; */
      cursor: pointer;
    }

    .dropbtn:hover, .dropbtn:focus {
      background-color: #3e8e41;
    }

    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      background-color: #f1f1f1;
      min-width: 160px;
      overflow: auto;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      right: 0;
      z-index: 1;
    }

    .dropdown-content a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .dropdown a:hover {background-color: #ddd;}

    .show{display: block;}
  </style> -->
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary" data-bs-theme="dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">My Cigars</a>
      <button class="navbar-toggler" type="button" onclick="toggleNav(event)" onCdata-bs-toggle="collapse" data-bs-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarColor01">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a id="cigarsnav" class="nav-link active" onclick="openTab(event, 'cigars')">Current Inventory</a>
          </li>
          <li class="nav-item">
            <a id="addcigarnav" class="nav-link" onclick="openTab(event, 'addcigar')">Add Cigars</a>
          </li>
          <li class="nav-item">
            <a id="settingsnav" class="nav-link" onclick="openTab(event, 'settings')">Settings</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- <div id="all" class="tabcontent column display-flex hide">
    <div class="section-heading">
      <div class="section-header">All Words</div>
      <button class="section-button" onclick="goHome()">Home</button>
    </div>
    <hr class="section-seperator"/>
    <div id="button-row" class="py display-flex column"></div>
    <div id="card-area" class="py display-flex column hide"></div>
    <div id="feedback" class="py display-flex column hide">
      <button class="button-med" onclick="giveFeedback('right')">Got it right</button>
      <button class="button-med" onclick="giveFeedback('wrong')">Got it wrong</button>
      <button id="dontshow" class="button-med" onclick="giveFeedback('dont')">Dont Show This Word Again</button>
      <button id="replaceall" class="button-med" onclick="giveFeedback('newgroup')">Replace all words in the group</button>
    </div>
    <div id="hidden-area" class="hide">
      <div id="current-part-of-speech"></div>
      <div id="current-word"></div>
    </div>
  </div> -->

  <div id="cigars" class="tabcontent column">
    <div class="section-heading">
      <h3 class="p-3">Current Inventory</h3>
    </div>
    <hr class="section-seperator"/>
    <div id="words-content">
    </div>
  </div>

  <!-- <div id="load" class="tabcontent column hide">
    <div class="section-heading">
      <div class="section-header">Data</div>
      <button class="section-button" onclick="goHome()">Home</button>
    </div>
    <hr class="section-seperator"/>
    <div class="py">
      <input type="file" id="file-input" />
    </div>
    <div class="py">
      <button onclick="load()">Load This Data</button>
      <button onclick="clearData()">Clear All Data</button>
    </div>
    <h3>Contents of the file:</h3>
    <div id="file-content"></div>
    <div id="hidden-file-content" class="hide"></div>
  </div> -->

  <!-- <div id="settings" class="tabcontent column hide">
    <div class="section-heading">
      <div class="section-header">Settings</div>
      <button class="section-button" onclick="goHome()">Home</button>
    </div>
    <hr class="section-seperator"/>
    <div class="py">
      <input type="radio" id="groupAll" name="learningtype" value="all" onchange="switchLearning()">
      <label for="all">Use all words on All tab</label>
    </div>
    <div class="py">
      <input type="radio" id="groupSmall" name="learningtype" value="groupSmall" onchange="switchLearning()">
      <label for="groupSmall">Use a group of 10 words on All tab</label>
    </div>
    <div class="py">
      <input type="radio" id="groupBig" name="learningtype" value="groupBig" onchange="switchLearning()">
      <label for="groupBig">Use a group of 20 words on Allg tab</label>
    </div>
    <hr style="width: 100%;">
    <div>
      <button class="button-big" onclick="exportData()">Export Data</button>
      <button class="button-big" onclick="document.getElementById('settings-input').click()">Import Data</button>
      <input type='file' id="settings-input" style="display:none">
    </div>
  </div> -->

  <div id="addcigar" class="tabcontent column hide">
    <div class="section-heading">
      <h3 class="p-3">Add Cigars</h3>
    </div>
    <hr class="section-seperator"/>
    <div id="add-content">
    </div>
  </div>
</body>

<script>
  window.onload = function (event) {
    // document.getElementById('file-input').addEventListener('change', readSingleFile, false);
    // document.getElementById('settings-input').addEventListener('change', importSettings, false);
    populateCigars();
    // populateLearn();
    // populateFavorite();
    // populateSettings();
    populateAddCigars();
    // if (localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'seengroupWords') == null) {
    //   localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + 'seengroupWords', JSON.stringify({}));
    // }
  }

  const APP_LOCAL_STORAGE_PREFIX = 'cigars';

  


  /*********************************************************************
   *                                                                   *
   *      This section if for loading of the data for the app
   * 
   *      The file needs to be a csv with # as the seperator
   *      and columns of German, Part of Speech, English followed
   *      by any other interesting things for the part of speech.
   * 
   *      Each Part Of Speech needs to be loaded individually.
   *      This is something I can change in the future.
   *                                                                   *  
   ********************************************************************/
   
   function readSingleFile(e) {
    var file = e.target.files[0];
    if (!file) {
      return;
    }
    var reader = new FileReader();
    reader.onload = function(e) {
      var contents = e.target.result;
      displayTableContents(contents);
    };
    reader.readAsText(file);
  }

  function load() {
    console.log('you wanna load?');

    var hiddenContentDiv = document.getElementById('hidden-file-content');
    var content = hiddenContentDiv.innerHTML;

    var lines = content.split('\r\n');
    var header = lines[0];
    var headerVals = header.split('#');

    if (!lines[1]) {
      alert("I could not find data to import. Are you sure you selected a file?");
      return;
    }

    // Get the part of speech for this file
    var partOfSpeech = lines[1].split('#')[1];

    var currentList = [];
    try {
      currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech)) || [];
    } catch (e) {
      console.log('havent seen that one before');
    }

    for (var i = 1; i < lines.length; i++) {
      if (!lines[i]) {
        continue;
      }
      
      var lineSplit = lines[i].split('#');
      
      var found = currentList.some(function (element) {
        return element[headerVals[0]] == lineSplit[0];
      });

      if (found) {
        continue;
      }

      var wordObject = {}
      for (var j = 0; j < headerVals.length; j++) {
        if (headerVals[j] == 'Part Of Speech') {
          continue;
        }
        wordObject[headerVals[j]] = lineSplit[j]
      }
      currentList.push(wordObject);
    }

    localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech, JSON.stringify(currentList));
    
    populateCigars();
    // populateLearn();
    // populateFavorite();
    
    alert(`Loaded ${partOfSpeech} successfully!`);
    deleteElementContents('hidden-file-content');
    deleteElementContents('file-content');
    document.getElementById('file-input').value = null
    
    console.log('done loading');
  }

  function displayTableContents(contents) {
    deleteElementContents('file-content');
    deleteElementContents('hidden-file-content');

    document.getElementById('hidden-file-content').textContent = contents;

    var fileContentDiv = document.getElementById('file-content');
    var table = document.createElement("table");
    var lines = contents.split('\n');
    
    var header = lines[0];
    var headerVals = header.split('#');
    var tableRow = document.createElement("tr");
    headerVals.forEach(element => {
      var tableHeader = document.createElement("th");
      tableHeader.innerHTML = element;
      tableRow.appendChild(tableHeader);
    });
    table.appendChild(tableRow);
    
    for (var i = 1; i < lines.length; i++) {
      if (!lines[i]) {
        continue;
      }
      var tableRow = document.createElement("tr");
      var lineSplit = lines[i].split('#');
      lineSplit.forEach(element => {
        var tableData = document.createElement("td");
        tableData.innerHTML = element;
        tableRow.appendChild(tableData);
      });
      table.appendChild(tableRow);
    }

    fileContentDiv.appendChild(table);
  }

  function deleteElementContents(elemId) {
    var element = document.getElementById(elemId);

    while (element.firstChild) {
      element.removeChild(element.lastChild);
    }
  }


  function clearData() {
    var areYouSure = confirmChoice('delete all of your data saved in the browser');
    if (!areYouSure) {
      return;
    }

    var partsOfSpeech = getPartsOfSpeechFromLocalStorage();

    partsOfSpeech.forEach((partOfSpeech) => {
      localStorage.removeItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech);
      localStorage.removeItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'group');
      localStorage.removeItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'Fav');
    });
    localStorage.removeItem(APP_LOCAL_STORAGE_PREFIX + 'seengroupWords');
    localStorage.removeItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype');
    localStorage.removeItem(APP_LOCAL_STORAGE_PREFIX + 'wordgroupNumber');
  }



  /*********************************************************************
   *                                                                   *
   *      This section if for showing all the words in the app
   *                                                                   *  
   ********************************************************************/

  function populateCigars() {
    var wordDiv = document.getElementById('words-content');
    var wordArea = document.createElement("div");
    wordArea.setAttribute('id', 'wordarea');
    wordArea.className = "p-3";
    wordDiv.appendChild(wordArea);
    // buildInventoryTable();
    buildInventoryGrid();
  }

  function buildInventoryGrid() {
    deleteElementContents('wordarea');
    var currentList = [];
    try {
      currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX));
    } catch (e) {
      console.log('havent seen that one before');
    }

    var wordArea = document.getElementById("wordarea");

    if (!currentList || currentList.length === 0) {
      var noCigars = document.createElement('h2');
      noCigars.innerHTML = "You have no cigars. Go to the Add Cigars page to add some.";
      wordArea.appendChild(noCigars);
      console.log('Add some cigars');
      openTab(event, 'addcigar');
      return;
    }

    // TODO: Add a sort capability for the grid
    // var sortDiv = document.createElement("div");
    // var sortBtn = document.createElement("button");
    // // sortBtn.addEventListener("click", smokeOne.bind(null, specificCigar, currentList));
    // sortBtn.innerHTML = "<i class=\"bi bi-cloud-fog2 mr-1\"></i> Sort by";
    // sortBtn.className = 'btn btn-sm btn-danger';
    // sortDiv.appendChild(sortBtn);
    // wordArea.appendChild(sortDiv);

    var grid = document.createElement("div");
    grid.className = 'd-flex flex-wrap';

    var headerVals = Object.keys(currentList[0]);
      
    currentList.forEach((specificCigar) => {
      var count = 0;
      var gridDiv = document.createElement("div");
      gridDiv.className = 'pb-3 col-sm-12 col-md-6 col-lg-3';

      var gridDiv2 = document.createElement("div");
      gridDiv2.className = 'p-2 m3 border rounded bg-primary h-100 d-flex flex-column justify-content-between';
      gridDiv.appendChild(gridDiv2);
      
      var gridInfo = document.createElement("div");
      headerVals.forEach(element => {
        if (element == 'Count') {
          count = specificCigar[element]
        }
        var gridRow = document.createElement("div");
        gridRow.className = 'container-fluid';
        var row = document.createElement('div');
        row.className = 'row';
        var rowLabel = document.createElement("div");
        rowLabel.className = 'col-4';
        rowLabel.innerHTML = element + ':';
        var rowValue = document.createElement('div');
        rowValue.innerHTML = specificCigar[element];
        rowValue.className = 'col-8';
        row.appendChild(rowLabel);
        row.appendChild(rowValue);
        gridRow.appendChild(row);
        gridInfo.appendChild(gridRow);
      });
      gridDiv2.appendChild(gridInfo);

      // Add the action button
      var actionDiv = document.createElement("div");
      actionDiv.className = 'd-flex justify-content-around pt-3';
      var smokedBtn = document.createElement("button");
      smokedBtn.addEventListener("click", smokeOne.bind(null, specificCigar, currentList));
      smokedBtn.innerHTML = "<i class=\"bi bi-cloud-fog2 mr-1\"></i>Smoke one";
      smokedBtn.className = 'btn btn-sm btn-danger';
      actionDiv.appendChild(smokedBtn);
      var boughtBtn = document.createElement("button");
      boughtBtn.addEventListener("click", boughtOne.bind(null, specificCigar, currentList));
      boughtBtn.innerHTML = "<i class=\"bi bi-currency-dollar mr-1\"></i>Bought one";
      boughtBtn.className = 'btn btn-sm btn-success';
      actionDiv.appendChild(boughtBtn);
      gridDiv2.appendChild(actionDiv);

      if (count != '0' && count != 0) {
        grid.appendChild(gridDiv);
      }
    });

    wordArea.appendChild(grid);
    wordArea.className = "";
  }

  function buildInventoryTable() {
    deleteElementContents('wordarea');
    var currentList = [];
    try {
      currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX));
    } catch (e) {
      console.log('havent seen that one before');
    }

    if (!currentList || currentList.length === 0) {
      console.log('Add some cigars');
      openTab(event, 'addcigar');
      return;
    }

    var wordArea = document.getElementById("wordarea");

    var table = document.createElement("table");
    table.className = 'table table-dark';

    var headerVals = Object.keys(currentList[0]);

    var tableHead = document.createElement("thead");
    var headerRow = document.createElement("tr");
    headerRow.className = 'table-active';
    headerVals.forEach(element => {
      var tableHeader = document.createElement("th");
      tableHeader.className = 'th-' + element;
      tableHeader.innerHTML = element;
      headerRow.appendChild(tableHeader);
    });
    var actionHeader = document.createElement("th");
    actionHeader.className = 'th-actions';
    actionHeader.innerHTML = "Actions";
    headerRow.appendChild(actionHeader);
    tableHead.appendChild(headerRow);
    table.appendChild(tableHead);
      
    var tablebody = document.createElement("tbody");
    currentList.forEach((specificCigar, i) => {
      var tableRow = document.createElement("tr");
      if (i % 2 != 0) {
        tableRow.className = 'table-primary';
      }
      headerVals.forEach(headerKey => {
        var tableData = document.createElement("td");
        tableData.innerHTML = specificCigar[headerKey];
        tableRow.appendChild(tableData);
      });
      // Add the action button
      var tableData = document.createElement("td");
      var actionDiv = document.createElement("div");
      actionDiv.className = 'dropdown';
      tableData.appendChild(actionDiv);
      tableRow.appendChild(tableData);
      var smokedBtn = document.createElement("button");
      smokedBtn.addEventListener("click", smokeOne.bind(null, specificCigar, currentList));
      smokedBtn.innerHTML = "Smoke one";
      smokedBtn.className = 'btn btn-sm btn-primary';
      actionDiv.appendChild(smokedBtn);
      var boughtBtn = document.createElement("button");
      boughtBtn.addEventListener("click", boughtOne.bind(null, specificCigar, currentList));
      boughtBtn.innerHTML = "Bought one";
      boughtBtn.className = 'btn btn-sm btn-primary';
      actionDiv.appendChild(boughtBtn);
      tablebody.appendChild(tableRow);
    });
    table.appendChild(tablebody);

    wordArea.appendChild(table);
    wordArea.className = "p-3";
  }

  function smokeOne(specificCigar, currentList) {
    console.log('you smoked one');
    if (specificCigar.Count > 0) {
      specificCigar.Count = parseInt(specificCigar.Count) - 1;
      localStorage.setItem(APP_LOCAL_STORAGE_PREFIX, JSON.stringify(currentList));
      // buildInventoryTable();
      buildInventoryGrid();
    }
  }

  function boughtOne(specificCigar, currentList) {
    console.log('you bought one');
    specificCigar.Count = parseInt(specificCigar.Count) + 1;
    localStorage.setItem(APP_LOCAL_STORAGE_PREFIX, JSON.stringify(currentList));
    // buildInventoryTable();
    buildInventoryGrid();
  }

  // function addDropdown(partOfSpeech, favorited, actionDiv, wordObject) {
  //   // Close all dropdowns before we open another one
  //   var dropdowns = document.getElementsByClassName("dropdown-content");
  //   var i;
  //   for (i = 0; i < dropdowns.length; i++) {
  //     var openDropdown = dropdowns[i];
  //     if (openDropdown.classList.contains('show')) {
  //       openDropdown.classList.remove('show');
  //     }
  //   }

  //   if (!document.getElementById(wordObject['German'])) {
  //     //alert("you want to toggle " + word['German']);
  //     var dropdownDiv = document.createElement("div");
  //     dropdownDiv.setAttribute('id', wordObject['German']);
  //     dropdownDiv.className = 'dropdown-content';
  //     actionDiv.appendChild(dropdownDiv);
      
  //     // Add actions
  //     var favBtn = document.createElement("a");
  //     favBtn.addEventListener("click", toggleFavorite.bind(null, partOfSpeech, actionDiv, wordObject));
  //     favBtn.innerHTML = favorited ? "Unfavorite" : "Favorite";
  //     favBtn.setAttribute('href', '');
  //     dropdownDiv.appendChild(favBtn);
      
  //     var editBtn = document.createElement("a");
  //     editBtn.addEventListener("click", toggleFavorite.bind(null, partOfSpeech, actionDiv, wordObject));
  //     editBtn.innerHTML = "Edit";
  //     editBtn.setAttribute('href', '');
  //     dropdownDiv.appendChild(editBtn);
          
  //     var deleteBtn = document.createElement("a");
  //     deleteBtn.addEventListener("click", toggleFavorite.bind(null, partOfSpeech, actionDiv, wordObject));
  //     deleteBtn.innerHTML = "Delete";
  //     deleteBtn.setAttribute('href', '');
  //     dropdownDiv.appendChild(deleteBtn);
  //   }

  //   document.getElementById(wordObject['German']).classList.toggle("show")    
  // }

  // // Close the dropdown if the user clicks outside of it
  // window.onclick = function(event) {
  //   if (!event.target.matches('.dropbtn')) {
  //     var dropdowns = document.getElementsByClassName("dropdown-content");
  //     var i;
  //     for (i = 0; i < dropdowns.length; i++) {
  //       var openDropdown = dropdowns[i];
  //       if (openDropdown.classList.contains('show')) {
  //         openDropdown.classList.remove('show');
  //       }
  //     }
  //   }
  // }

  // function toggleFavorite(partOfSpeech, actionDiv, word) {
  //   var favList = [];
  //   try {
  //     favList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + "Fav"));
  //   } catch (e) {
  //     console.log('havent seen that one before');
  //   }
    
  //   if (favBtn.innerHTML == "Add") {
  //     favBtn.innerHTML = "Remove";
  //     favBtn.className = 'button-blue';
  //     favList.push(word);
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + "Fav", JSON.stringify(favList));
  //   } else {
  //     favBtn.innerHTML = "Add";
  //    favBtn.className = 'button-green';
  //     favList = favList.filter(elem => elem['German'] != word['German']);
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + "Fav", JSON.stringify(favList));
  //   }
  // }


  // /*********************************************************************
  //  *                                                                   *
  //  *      This section if for learning all the words in the app
  //  *                                                                   *  
  //  ********************************************************************/

  // function populateLearn() {
  //   deleteElementContents('button-row');

  //   var partsOfSpeech = getPartsOfSpeechFromLocalStorage();
    
  //   var buttonRow = document.getElementById('button-row');
  //   partsOfSpeech.forEach(function(partOfSpeech) {
  //     var button = document.createElement("button");
  //     button.setAttribute("onclick", `showNewCard("${partOfSpeech}")`);
  //     button.className = 'button-big';
  //     button.innerHTML = `Show me a ${partOfSpeech}`;
  //     buttonRow.appendChild(button);
  //   });

  //   var groupType = localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype') || 'all';
  //   var show = 'dontshow';
  //   var hide = 'replaceall';
  //   if (groupType != 'all') {
  //     show = 'replaceall';
  //     hide = 'dontshow';
  //   }
  //   var hideButton = document.getElementById(hide);
  //   if (!hideButton.classList.contains('hide')) {
  //     hideButton.classList.add("hide");
  //   }
  //   document.getElementById(show).classList.remove('hide');
  // }

  // function showNewCard(partOfSpeech) {
  //   deleteElementContents('card-area');
  //   var currentList = [];
  //   try {
  //     if (['groupsmall','groupbig'].includes(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype'))) {
  //       currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'group'));
  //     } else {
  //       currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech));
  //     }
  //   } catch (e) {
  //     console.log('havent seen that one before');
  //   }

  //   var cardArea = document.getElementById("card-area");

  //   var wordNumber = parseInt(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'wordgroupNumber'));
  //   if (isNaN(wordNumber) || wordNumber > currentList.length-1) {
  //     wordNumber = 0;
  //   }
  //   var randomWord = currentList[wordNumber]

  //   if (!randomWord) {
  //     randomWord = {'German': `Could not find a ${partOfSpeech}`, 'English': `Could not find a ${partOfSpeech}`};
  //   }

  //   document.getElementById('current-part-of-speech').innerHTML = partOfSpeech;
  //   document.getElementById('current-word').innerHTML = randomWord['German'];

  //   var frontText = Math.random() > 0.5 ? randomWord["German"] : randomWord["English"];

  //   var frontcard = document.createElement("div");
  //   frontcard.setAttribute("id", 'front-card');
  //   frontcard.setAttribute("onclick", "flipCard()");
  //   frontcard.className = 'front-card';
  //   frontcard.innerHTML = frontText;
  //   cardArea.appendChild(frontcard);

  //   var backcard = document.createElement("div");
  //   backcard.setAttribute("id", 'back-card');
  //   backcard.className = 'back-card display-flex column hide';
  //   Object.keys(randomWord).forEach((key) => {
  //     var line = document.createElement("div");
  //     line.innerHTML = `${key}: ${randomWord[key]}`;
      
  //     if (key == 'Part of Speech' || randomWord[key] == '') {
  //       return;
  //     }
  //     backcard.appendChild(line);
  //   });
  //   cardArea.appendChild(backcard);
  //   cardArea.classList.remove('hide');

  //   localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + 'wordgroupNumber', wordNumber+1);
  //   document.getElementById('button-row').classList.add('hide');
  // }

  // function flipCard() {
  //   document.getElementById('front-card').className = 'hide';
  //   document.getElementById('back-card').classList.remove('hide');
  //   document.getElementById('feedback').classList.remove('hide');
  // }

  // function giveFeedback(feedback) {
  //   var partOfSpeech = document.getElementById('current-part-of-speech').innerHTML;
  //   var word = document.getElementById('current-word').innerHTML;
  //   var currentGrouping = localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype') || 'all';
  //   var storageString = currentGrouping == 'all' ? partOfSpeech : partOfSpeech + 'group';
  //   var currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + storageString));
  //   var wordObject = currentList.filter((wordObj) => wordObj['German'] == word);
    
  //   if (wordObject.length != 1) {
  //     document.getElementById('button-row').classList.remove('hide');
  //     document.getElementById('card-area').classList.add('hide');
  //     document.getElementById('feedback').classList.add('hide');
  //   }
  //   if (feedback == 'dont') {
  //     var newList = currentList.filter((wordObj) => wordObj['German'] != word);
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + storageString, JSON.stringify(newList));
  //   } else if (feedback == 'right') {
  //     wordObject[0]['Streak'] ? wordObject[0]['Streak'] += 1 : wordObject[0]['Streak'] = 1;
  //     if (wordObject[0]['Streak'] >= 6 && currentGrouping != 'all') {
  //       var nowTime = (new Date()).getTime();
  //       var seenWords = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'seengroupWords'));
  //       seenWords[wordObject[0]['German']] = nowTime;

  //       currentList = currentList.filter((wordObj) => wordObj['German'] != word);
  //       var wholeList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech));
  //       var randomWord = null;
  //       var count = 0;
  //       while (!randomWord && count < 10000) {
  //         count++;
  //         var number = Math.floor(Math.random() * wholeList.length);
  //         try {
  //           if (!wholeList.length) {
  //             continue;
  //           }
            
  //           if (!seenWords[wholeList[number]['German']] || seenWords[wholeList[number]['German']] < (nowTime - 604800)) {
  //             randomWord = wholeList[number];
  //             randomWord['Streak'] = 0;
  //           }
  //         } catch (e) {
  //           console.log(e);
  //         }
  //       }
  //       currentList.push(randomWord);
  //       localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + 'seengroupWords', JSON.stringify(seenWords));
  //     }
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + storageString, JSON.stringify(currentList));
  //   } else if (feedback == 'wrong') {
  //     wordObject[0]['Streak'] = 0;
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + storageString, JSON.stringify(currentList));
  //   }  else if (feedback == 'newgroup') {
  //     resetPartOfSpeechGroup(partOfSpeech);
  //   }
  //   document.getElementById('button-row').classList.remove('hide');
  //   document.getElementById('card-area').classList.add('hide');
  //   document.getElementById('feedback').classList.add('hide');
  // }


  // /*********************************************************************
  //  *                                                                   *
  //  *      This section if for settings
  //  *                                                                   *  
  //  ********************************************************************/

  // function populateSettings() {
  //   var currentGrouping = localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype') || 'all';
    
  //   var allRadio = document.getElementById('groupAll');
  //   currentGrouping == 'all' ? allRadio.checked = true : allRadio.checked = false;

  //   var smallGroupRadio = document.getElementById('groupSmall');
  //   currentGrouping == 'groupsmall' ? smallGroupRadio.checked = true : smallGroupRadio.checked = false;

  //   var bigGroupRadio = document.getElementById('groupBig');
  //   currentGrouping == 'groupbig' ? bigGroupRadio.checked = true : bigGroupRadio.checked = false;
  // }

  // function switchLearning(evt) {
  //   console.log('in switchLearning');
  //   if (document.getElementById('groupAll').checked) {
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype', 'all');
  //     var replaceAll = document.getElementById('replaceall');
  //     if (!replaceAll.classList.contains('hide')) {
  //       replaceAll.classList.add("hide");
  //     }
  //     document.getElementById('dontshow').classList.remove('hide');
  //     return;
  //   }
  //   if (document.getElementById('groupSmall').checked) {
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype', 'groupsmall');
  //   }
  //   if (document.getElementById('groupBig').checked) {
  //     localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype', 'groupbig');
  //   }
  //   var dontshow = document.getElementById('dontshow');
  //   if (!dontshow.classList.contains('hide')) {
  //     dontshow.classList.add("hide");
  //   }
  //   document.getElementById('replaceall').classList.remove('hide');
  //   var partsOfSpeech = getPartsOfSpeechFromLocalStorage();
  //   partsOfSpeech.forEach((partOfSpeech) => {
  //     resetPartOfSpeechGroup(partOfSpeech);
  //   });
  // }

  // function resetPartOfSpeechGroup(partOfSpeech) {
  //   var nowTime = (new Date()).getTime();
  //   var seenWords = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'seengroupWords'));
  //   var currentGrouping = localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype') || 'groupsmall';
  //   var numInGroup = currentGrouping == 'groupbig' ? 20 : 10;
  //   var wholeList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech));
  //   var shortList = [];
  //   for (var i = 0; i < numInGroup; i++) {
  //     var randomWord = null;
  //     var count = 0;
  //     while (!randomWord && count < 10000) {
  //       count++;
  //       var number = Math.floor(Math.random() * wholeList.length);
  //       try {
  //         if (!wholeList.length) {
  //           continue;
  //         }
          
  //         if (!seenWords[wholeList[number]['German']] || seenWords[wholeList[number]['German']] < (nowTime - 604800)) {
  //           randomWord = wholeList[number];
  //           randomWord['Streak'] = 0;
  //         }
  //       } catch (e) {
  //         console.log(e);
  //       }
  //     }
  //     shortList.push(randomWord);
  //   }

  //   localStorage.setItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'group', JSON.stringify(shortList));
  // }

  function exportData() {
    alert('exporting data');
    var allData = {};
    var partsOfSpeech = getPartsOfSpeechFromLocalStorage();
    partsOfSpeech.forEach(function(partOfSpeech) {
      var wholeList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech));
      var groupList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'group'));
      var favorList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'Fav'));

      allData[APP_LOCAL_STORAGE_PREFIX + partOfSpeech] = wholeList;
      allData[APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'group'] = groupList;
      allData[APP_LOCAL_STORAGE_PREFIX + partOfSpeech + 'Fav'] = favorList;
    });

    var groupType = localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'grouptype');
    var seenGroupWords = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX + 'seengroupWords'));
    allData[APP_LOCAL_STORAGE_PREFIX + 'grouptype'] = groupType;
    allData[APP_LOCAL_STORAGE_PREFIX + 'seengroupWords'] = seenGroupWords;

    download(JSON.stringify(allData), 'settings.txt', 'text/plain');
  }

  function download(content, fileName, contentType) {
    var a = document.createElement("a");
    var file = new Blob([content], {type: contentType});
    a.href = URL.createObjectURL(file);
    a.download = fileName;
    a.click();
  }

  function importSettings(e) {
    var file = e.target.files[0];
    if (!file) {
      return;
    }
    var reader = new FileReader();
    reader.onload = function(e) {
      var contents = e.target.result;
      try {
        contents = JSON.parse(contents);
      } catch(e) {
        alert("Could not parse that file. :(");
      }
      var keys = Object.keys(contents);
      keys.forEach((key) => {
        var value = contents[key];
        localStorage.setItem(key, JSON.stringify(value));
      });

      populateCigars();
      // populateLearn();
      // populateFavorite();
      
      alert("Settings uploaded!");
    };
    reader.readAsText(file);
  }


  /*********************************************************************
   *                                                                   *
   *      This section if for adding cigars to the app
   *                                                                   *  
   ********************************************************************/

  function populateAddCigars() {
    var addDiv = document.getElementById('add-content');
    var addArea = document.createElement("div");
    addArea.setAttribute('id', 'addarea');
    addArea.className = "hide";
    addDiv.appendChild(addArea);
    makeAddCigarTable();
  }

  function makeAddCigarTable() {
    deleteElementContents('addarea');
    var currentList = [];
    try {
      currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX));
    } catch (e) {
      console.log('havent seen that one before');
    }

    var addArea = document.getElementById("addarea");

    var headerVals;
    if (!currentList || !currentList.length) {
      headerVals = ['Brand', 'Name', 'Count'];
    } else {
      headerVals = Object.keys(currentList[0]);
    }
    //var tableRow = document.createElement("tr");
    for (var i = 0; i < headerVals.length; i++) {
      var element = headerVals[i];
      var containerDiv = document.createElement("div");
      containerDiv.className = 'container';
      var rowDiv = document.createElement("div");
      rowDiv.className = 'row pb-2 form-div';
      containerDiv.appendChild(rowDiv);
      
      var label = document.createElement('div');
      label.className = "col-2";
      label.innerHTML = element;
      rowDiv.appendChild(label);
      
      var inputDiv = document.createElement('div');
      inputDiv.className = "col-10";
      var input = document.createElement('input');
      if (element !== 'Count') {
        input.setAttribute('type', 'text');
      } else {
        input.setAttribute('type', 'number');
      }
      input.setAttribute('id', element);
      input.setAttribute('required', true);
      input.className = 'w-100';
      inputDiv.appendChild(input);
      rowDiv.appendChild(inputDiv);
      addArea.appendChild(containerDiv);
    }

    var buttonDiv = document.createElement("div");
    buttonDiv.className = 'd-flex justify-content-center';
    var addBtn = document.createElement("button");
    addBtn.addEventListener("click", addnewcigar.bind(null, currentList));
    addBtn.innerHTML = "Add";
    addBtn.className = 'btn btn-success';
    buttonDiv.appendChild(addBtn);
    addArea.appendChild(buttonDiv);
    addArea.className = "";
  }

  function addnewcigar(currentList) {
    var currentList = [];
    try {
      currentList = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX));
      if (!currentList) {
        currentList = [];
      }
    } catch (e) {
      console.log('havent seen that one before');
    }

    var formDivs = document.getElementsByClassName("form-div");
    var newWordObject = {};
    for (var i =  0; i < formDivs.length; i++) {
      var key = formDivs[i].firstElementChild.innerHTML;
      var value = document.getElementById(key).value; // formDivs[i].lastElementChild.value;
      if (!value || value == '') {
        alert("Please add a value for " + key);
        return;
      }
      newWordObject[key] = value;
    }

    var r = confirm("Do you want to submit as is?");
    
    if (!r) {
      return;
    }

    let found;
    currentList.forEach((cigar) => {
      if (cigar.Brand === newWordObject.Brand && cigar.Name === newWordObject.Name) {
        found = cigar;
      }
    });
    
    let s = true;
    if (found) {
      s = confirm("That cigar already exists in your humidor. Do you want to add this to the count?")
    }
    
    if (!s) {
      return;
    }

    if (found) {
      found.Count = parseInt(found.Count) + parseInt(newWordObject.Count);
    } else {
      currentList.push(newWordObject)
    }

    console.log('gonna add it!');

    // sort by name
    currentList.sort(function(a, b) {
      var nameA = a.Brand.toUpperCase();
      var nameB = b.Brand.toUpperCase();
      if (nameA < nameB) {
        return -1;
      }
      if (nameA > nameB) {
        return 1;
      }

      // names must be equal
      return 0;
    });
    localStorage.setItem(APP_LOCAL_STORAGE_PREFIX, JSON.stringify(currentList));
    deleteElementContents('addarea');
    makeAddCigarTable();
    // buildInventoryTable();
    buildInventoryGrid();
  }

  /*********************************************************************
   *                                                                   *
   *      This section is for helper functions
   *                                                                   *  
   ********************************************************************/

  function toggleNav(evt) {
    var navCollapse = document.getElementsByClassName("navbar-collapse")[0];
    if (navCollapse.classList.contains('show')) {
      navCollapse.classList.remove('show');
    } else {
      navCollapse.classList.add('show');
    }
  }

  function closeNav(evt) {
    var navCollapse = document.getElementsByClassName("navbar-collapse")[0];
    navCollapse.classList.remove('show');
  }

  function openTab(evt, tabName) {
    closeNav();
    var navLinks = document.getElementsByClassName('nav-link');
    for (var i = 0; i < navLinks.length; i++) {
      navLinks[i].classList.remove('active');
    }
    var navActive = document.getElementById(tabName + 'nav');
    navActive.classList.add('active');

    var tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      if (!tabcontent[i].classList.contains('hide')) {
        tabcontent[i].classList.add("hide");
      }
      tabcontent[i].classList.remove("display-flex");
    }
    document.getElementById(tabName).classList.remove("hide");
    document.getElementById(tabName).classList.add("display-flex");
  }

  function getCigarBrandsFromLocalStorage() {
    const obj = JSON.parse(localStorage.getItem(APP_LOCAL_STORAGE_PREFIX));
    return Object.keys(obj);

    // return Object.keys(localStorage).reduce((accumulator, option) => {
    //   if(option.startsWith(APP_LOCAL_STORAGE_PREFIX)) {
    //     var posNoPrefix = option.split('.')[1];
    //     accumulator.push(posNoPrefix);
    //   }
    //   return accumulator;
    // },[]);
  }

  function confirmChoice(message) {
    return confirm(`You are about to ${message}. This can not be undone. Are you sure?`);
  }

</script>

</html>
